{% extends "base.html" %}
{% block content %}

<h3 class="center-align"> All Books </h3>

<!--only shows if user is logged in-->
{% if session['user'] %}
<div class="center-align">
    <a href="{{ url_for('add_book') }}" class="waves-effect waves-light amber darken-2 btn">Add Book!</a>
</div>
{% endif %}

<ul class="collapsible">
    {% for book in books %}
    <li>
        <div class="collapsible-header">
            <i class="fas fa-book"></i>
            <div class="padding-right">Name: {{ book.title.capitalize() }}</div>
            <div class="padding-right">Genre: {{ book.genre.capitalize() }}</div>
            <div class="padding-right">Author: {{ book.author.capitalize() }}</div>
            <div class="padding-right">Year Of Publishing: {{ book.year }}</div>
            <div>Rating: {{ book.rating }}/5</div>
        </div>
        <div class="collapsible-body">
            <div class="row">
                <div class="col s12 ">
                  <div class="card amber darken-4">
                    <div class="card-content white-text">
                      <span class="card-title">Synopsis:</span>
                      <div>{{ book.synopsis }}</div>
                      <div>Series: {{ book.series_name }}</div>
                    </div>
                  </div>
                </div>
              </div>
            <div>
                <ul class="collection with-header">
                    <li class="collection-header">
                        <h4><i class="fas fa-align-left"></i>Reviews</h4>

                        <a href="{{ url_for('review_book', book_id=book._id) }}"
                            class="waves-effect waves-light btn amber darken-2">Review Book</a>
                    
                        </li>

                    {% for review in reviews %}
                    <!--gets all reviews that match current book-->
                    {% if review.book_id == book._id|string %}

                    <li class="collection-item"><blockquote >"{{ review.review }}" - {{ review.reviewer }}</blockquote>
                        <!--only shows if review belongs to user-->
                        {% if review.reviewer == session["user"] %}

                        <a href="{{ url_for('edit_review', review_id=review._id) }}"
                            class="waves-effect waves-light btn-small amber darken-2">Edit Review</a>
                        <!--only shows if review belongs to user or if user is admin-->
                        {% if review.reviewer == session["user"] or user["admin"] %}

                        <a href="{{ url_for('delete_review', review_id=review._id) }}"
                            class="waves-effect waves-light btn-small red darken-2">Delete Review</a>

                        {% endif %}
                        {% endif %}

                    </li>

                    {% endif %}
                    {% endfor %}

                </ul>
            </div>


            <div class="row">
                <!--only shows if review belongs to user or if user is admin-->
                {% if book.added_by == session['user'] or user["admin"] %}
                <a href="{{ url_for('delete_book', book_id=book._id) }}"
                    class="waves-effect waves-light btn-small red darken-2">Delete Book</a>
                {% endif %}
            </div>

        </div>
        </div>
    </li>
    {% endfor %}
</ul>

{% endblock %}